<p-toast />

<div class="surface-ground flex align-items-center justify-content-center min-h-screen"
  style="background:var(--surface-ground)">
  <div class="surface-card p-4 shadow-2 border-round w-full lg:w-6">
    <!--Form Test-->
    <div class="grid">
      <div class="col-12">
        <p-dialog header="Dialog" [(visible)]="display" [modal]="true" showEffect="fade" [style]="{width: '60vw'}"
          [breakpoints]="{'960px': '75vw'}">
          <p-accordion>
            <p-accordionTab header="Form Values" [selected]="true" class="line-height-3 m-0">
              <pre class="p-2 border rounded bg-gray-100" style="white-space: pre-wrap;">{{ formJson }}</pre>
            </p-accordionTab>
            <p-accordionTab header="Model"  class="line-height-3 m-0">
             <pre class="p-2 border rounded bg-gray-100" style="white-space: pre-wrap;">{{ modelJson }}</pre>
            </p-accordionTab>
            <p-accordionTab header="Form Errors" class="line-height-3 m-0">
              <pre class="p-2 border rounded bg-gray-100" style="white-space: pre-wrap;">{{ formErrors }}</pre>
            </p-accordionTab>
            <p-accordionTab header="Form Status" class="line-height-3 m-0">
              <p><strong>Valid:</strong> {{ registerForm.valid }}</p>
              <p><strong>Touched:</strong> {{ registerForm.touched }}</p>
              <p><strong>Dirty:</strong> {{ registerForm.dirty }}</p>
              <p><strong>Status:</strong> {{ registerForm.status }}</p>
            </p-accordionTab>
          </p-accordion>
          <ng-template pTemplate="footer">
            <button pButton icon="pi pi-check" (click)="display=false" label="Ok" class="p-button-outlined"></button>
          </ng-template>
        </p-dialog>
        <div class="grid">
          <div class="col-12 flex justify-content-end">
            <button (click)="display=true" pButton icon="pi pi-external-link" label="Show"></button>
          </div>
        </div>
      </div>
    </div>
    <!--. end Form Test-->
    <div class="grid">
      <div class="col-12">
        <div class="field grid">
          <div class="col-8 flex flex-wrap gap-2">
            <p-inputMask mask="999-999-9999" placeholder="xxx-xxx-xxxx" [slotChar]="'_'" [(ngModel)]="tokenValue">
            </p-inputMask>
            <button pButton pRipple label="Validate" (click)="vaildateToken()"></button>
          </div>
        </div>
      </div>
      <div class="col-12">
        <p-steps [model]="items" [activeIndex]="activeIndex" [readonly]="false"></p-steps>
        <form [formGroup]="registerForm" class="pt-4" >
          <div *ngIf="activeIndex === 0" formGroupName="accountInfo">
            <div class="p-fluid p-formgrid grid">
              <div class="field col-12 md:col-6">
                <p-inputGroup>
                  <p-inputGroupAddon>
                    <i class="pi pi-envelope"></i>
                  </p-inputGroupAddon>
                  <input type="email" pInputText id="email" formControlName="email" placeholder="Email" />
                </p-inputGroup>
              </div>
              <div class="field col-12 md:col-6">
                <p-inputGroup>
                  <p-inputGroupAddon>
                    <i class="pi pi-phone"></i>
                  </p-inputGroupAddon>
                  <input type="tel" pInputText id="phoneNumber" formControlName="phoneNumber"
                    placeholder="Phone Number" />
                </p-inputGroup>
              </div>
              <div class="field col-12 md:col-6">
                <span class="p-float-label">
                  <p-password id="password" formControlName="password" [toggleMask]="true" class="w-full"></p-password>
                  <label htmlFor="password">Password</label>
                </span>
              </div>
              <div class="field col-12 md:col-6">
                <span class="p-float-label">
                  <p-password id="confirmPassword" formControlName="confirmPassword" [toggleMask]="true"
                    class="w-full"></p-password>
                  <label htmlFor="confirmPassword">Confirm Password</label>
                </span>
              </div>
            </div>
          </div>
          <div *ngIf="activeIndex === 1" formGroupName="personalInfo">
            <div class="p-fluid p-formgrid grid">
              <div class="field col-12 md:col-6">
                <p-inputGroup>
                  <p-inputGroupAddon>
                    <i class="pi pi-user"></i>
                  </p-inputGroupAddon>
                  <input type="text" pInputText id="name" formControlName="name" placeholder="Username">
                </p-inputGroup>
              </div>
              <div class="field col-12 md:col-6">
                <p-calendar [showIcon]="true" inputId="icon" formControlName="birthDate"
                  placeholder="Birth Date"></p-calendar>
              </div>
              <div class="col-12 md:col-6">
                <p-autoComplete formControlName="maritalStatus" [suggestions]="filteredMaritalStatus"
                  (completeMethod)="filterMaritalStatus($event)" field="value" [dropdown]="true"
                  placeholder="Marital Status"></p-autoComplete>
              </div>
              <div class="col-12 md:col-6">
                <p-autoComplete formControlName="gender" [suggestions]="filteredGender"
                  (completeMethod)="filterGender($event)" field="value" [dropdown]="true" placeholder="Gender">
                </p-autoComplete>
              </div>
              <div class="field col-12">
                <p-fileUpload 
                [maxFileSize]="5 * 1024 * 1024"
                [multiple]="false" 
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                [showUploadButton]="false" 
                [showCancelButton]="false" 
                chooseLabel="Add Profile Photo"
                (onSelect)="onProfilePhotoSelect($event)" 
                (onRemove)="onProfilePhotoRemove()"
                [customUpload]="true"
                [class.ng-invalid]="registerForm.get('personalInfo.profilePhoto')?.errors"
                [class.ng-dirty]="registerForm.get('personalInfo.profilePhoto')?.touched">
              </p-fileUpload>
              </div>
            </div>
          </div>
          <div *ngIf="activeIndex === 2" formGroupName="address">
            <div class="p-fluid p-formgrid grid">
              <div class="field col-12 md:col-6">
                <p-autoComplete formControlName="Country" [suggestions]="filteredCountries"
                  (completeMethod)="filterCountries($event)" dataKey="countryId" field="countryName" [dropdown]="true"
                  (onSelect)="onCountrySelect($event)" placeholder="Country">
                </p-autoComplete>
              </div>
              <div class="field col-12 md:col-6">
                <p-autoComplete formControlName="State" [suggestions]="filteredStates"
                  (completeMethod)="filterStates($event)" dataKey="stateId" field="stateName" [dropdown]="true"
                  (onSelect)="onStateSelect($event)" placeholder="State">
                </p-autoComplete>
              </div>
              <div class="field col-12 md:col-6">
                <p-autoComplete formControlName="Dist" [suggestions]="filteredDists"
                  (completeMethod)="filterDists($event)" dataKey="distId" field="distName" [dropdown]="true"
                  placeholder="Dist">
                </p-autoComplete>
              </div>
              <div class="field col-12 md:col-6">
                <span class="p-float-label">
                  <input type="text" pInputText id="at" formControlName="at" class="w-full">
                  <label htmlFor="at">At</label>
                </span>
              </div>
              <div class="field col-12 md:col-6">
                <span class="p-float-label">
                  <input type="text" pInputText id="post" formControlName="post" class="w-full">
                  <label htmlFor="post">Post</label>
                </span>
              </div>
              <div class="field col-12 md:col-6">
                <span class="p-float-label">
                  <input type="text" pInputText id="city" formControlName="city" class="w-full">
                  <label htmlFor="city">City</label>
                </span>
              </div>
              <div class="field col-12 md:col-6">
                <span class="p-float-label">
                  <input type="text" pInputText id="pinCode" formControlName="pinCode" class="w-full">
                  <label htmlFor="pinCode">Pin Code</label>
                </span>
              </div>
            </div>
          </div>
          <!-- Navigation Buttons -->
          <div class="flex justify-content-between mt-4">
            <p-button label="Previous" (onClick)="prevStep()" [disabled]="activeIndex === 0"></p-button>
            <p-button *ngIf="activeIndex < 2" label="Next" (onClick)="nextStep()"
              [disabled]="!isStepValid(activeIndex)"></p-button>
            <p-button *ngIf="activeIndex === 2" label="Submit" (onClick)="signUp()"
              [disabled]="!registerForm.valid"></p-button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>